{
  "$schema": "https://github.com/Azure/data-api-builder/releases/download/v1.1.7/dab.draft.schema.json",
  "data-source": {
    "database-type": "mssql",
    "connection-string": "@env('DATABASE_CONNECTION_STRING')"
  },
  "runtime": {
    "rest": {
      "enabled": true,
      "path": "/api"
    },
    "graphql": {
      "enabled": true,
      "path": "/graphql",
      "allow-introspection": true
    },
    "host": {
      "cors": {
        "origins": ["http://localhost:5173", "http://localhost:3000", "http://localhost:5175"],
        "allow-credentials": true
      }
    }
  },
  "entities": {
    "User": {
      "source": "dbo.Users",
      "permissions": [
        {
          "role": "anonymous",
          "actions": [
            { "action": "create" },
            { "action": "read" },
            { "action": "update" }
          ]
        }
      ],
      "relationships": {
        "tools": {
          "cardinality": "many",
          "target.entity": "Tool",
          "source.fields": ["id"],
          "target.fields": ["ownerId"]
        },
        "reservationsAsBorrower": {
          "cardinality": "many",
          "target.entity": "Reservation",
          "source.fields": ["id"],
          "target.fields": ["borrowerId"]
        },
        "circleMemberships": {
          "cardinality": "many",
          "target.entity": "CircleMember",
          "source.fields": ["id"],
          "target.fields": ["userId"]
        }
      }
    },
    "Circle": {
      "source": "dbo.Circles",
      "permissions": [
        {
          "role": "anonymous",
          "actions": [
            { "action": "create" },
            { "action": "read" },
            { "action": "update" }
          ]
        }
      ],
      "relationships": {
        "members": {
          "cardinality": "many",
          "target.entity": "CircleMember",
          "source.fields": ["id"],
          "target.fields": ["circleId"]
        },
        "toolCircles": {
          "cardinality": "many",
          "target.entity": "ToolCircle",
          "source.fields": ["id"],
          "target.fields": ["circleId"]
        }
      }
    },
    "CircleMember": {
      "source": "dbo.CircleMembers",
      "permissions": [
        {
          "role": "anonymous",
          "actions": [
            { "action": "read" },
            { "action": "create" },
            { "action": "delete" }
          ]
        }
      ],
      "relationships": {
        "user": {
          "cardinality": "one",
          "target.entity": "User",
          "source.fields": ["userId"],
          "target.fields": ["id"]
        },
        "circle": {
          "cardinality": "one",
          "target.entity": "Circle",
          "source.fields": ["circleId"],
          "target.fields": ["id"]
        }
      }
    },
    "Tool": {
      "source": "dbo.Tools",
      "permissions": [
        {
          "role": "anonymous",
          "actions": [
            { "action": "create" },
            { "action": "read" },
            { "action": "update" },
            { "action": "delete" }
          ]
        }
      ],
      "relationships": {
        "owner": {
          "cardinality": "one",
          "target.entity": "User",
          "source.fields": ["ownerId"],
          "target.fields": ["id"]
        },
        "photos": {
          "cardinality": "many",
          "target.entity": "ToolPhoto",
          "source.fields": ["id"],
          "target.fields": ["toolId"]
        },
        "toolCircles": {
          "cardinality": "many",
          "target.entity": "ToolCircle",
          "source.fields": ["id"],
          "target.fields": ["toolId"]
        },
        "reservations": {
          "cardinality": "many",
          "target.entity": "Reservation",
          "source.fields": ["id"],
          "target.fields": ["toolId"]
        }
      }
    },
    "ToolPhoto": {
      "source": "dbo.ToolPhotos",
      "permissions": [
        {
          "role": "anonymous",
          "actions": [
            { "action": "read" },
            { "action": "create" },
            { "action": "delete" }
          ]
        }
      ],
      "relationships": {
        "tool": {
          "cardinality": "one",
          "target.entity": "Tool",
          "source.fields": ["toolId"],
          "target.fields": ["id"]
        }
      }
    },
    "ToolCircle": {
      "source": "dbo.ToolCircles",
      "permissions": [
        {
          "role": "anonymous",
          "actions": [
            { "action": "read" },
            { "action": "create" },
            { "action": "delete" }
          ]
        }
      ],
      "relationships": {
        "tool": {
          "cardinality": "one",
          "target.entity": "Tool",
          "source.fields": ["toolId"],
          "target.fields": ["id"]
        },
        "circle": {
          "cardinality": "one",
          "target.entity": "Circle",
          "source.fields": ["circleId"],
          "target.fields": ["id"]
        }
      }
    },
    "Reservation": {
      "source": "dbo.Reservations",
      "permissions": [
        {
          "role": "anonymous",
          "actions": [
            { "action": "read" },
            { "action": "create" },
            { "action": "update" }
          ]
        }
      ],
      "relationships": {
        "tool": {
          "cardinality": "one",
          "target.entity": "Tool",
          "source.fields": ["toolId"],
          "target.fields": ["id"]
        },
        "borrower": {
          "cardinality": "one",
          "target.entity": "User",
          "source.fields": ["borrowerId"],
          "target.fields": ["id"]
        },
        "photos": {
          "cardinality": "many",
          "target.entity": "LoanPhoto",
          "source.fields": ["id"],
          "target.fields": ["reservationId"]
        },
        "reviews": {
          "cardinality": "many",
          "target.entity": "Review",
          "source.fields": ["id"],
          "target.fields": ["reservationId"]
        }
      }
    },
    "LoanPhoto": {
      "source": "dbo.LoanPhotos",
      "permissions": [
        {
          "role": "anonymous",
          "actions": [
            { "action": "read" },
            { "action": "create" }
          ]
        }
      ],
      "relationships": {
        "reservation": {
          "cardinality": "one",
          "target.entity": "Reservation",
          "source.fields": ["reservationId"],
          "target.fields": ["id"]
        }
      }
    },
    "Review": {
      "source": "dbo.Reviews",
      "permissions": [
        {
          "role": "anonymous",
          "actions": [
            { "action": "read" },
            { "action": "create" }
          ]
        }
      ],
      "relationships": {
        "reservation": {
          "cardinality": "one",
          "target.entity": "Reservation",
          "source.fields": ["reservationId"],
          "target.fields": ["id"]
        },
        "reviewer": {
          "cardinality": "one",
          "target.entity": "User",
          "source.fields": ["reviewerId"],
          "target.fields": ["id"]
        },
        "reviewee": {
          "cardinality": "one",
          "target.entity": "User",
          "source.fields": ["revieweeId"],
          "target.fields": ["id"]
        }
      }
    },
    "Notification": {
      "source": "dbo.Notifications",
      "permissions": [
        {
          "role": "anonymous",
          "actions": [
            { "action": "read" },
            { "action": "update", "fields": { "include": ["isRead"] } }
          ]
        }
      ],
      "relationships": {
        "user": {
          "cardinality": "one",
          "target.entity": "User",
          "source.fields": ["userId"],
          "target.fields": ["id"]
        }
      }
    }
  }
}
